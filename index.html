function cargarCatalogo() {
  fetch("https://script.google.com/macros/s/AKfycbwY5TFocek-mo2wHTNGDp8LF_1uGKZvS6Ear6kPErZFz8R2Fl9MuDKx885b_RFufvWI/exec")
    .then(r => r.json())
    .then(regalos => {
      const cont = document.getElementById("lista");
      cont.innerHTML = "";

      regalos.forEach(reg => {
        const div = document.createElement("div");
        div.className = "item";

        div.innerHTML = `
          <img src="${reg.imagen}">
          <h3>${reg.nombre}</h3>
          <p>${reg.descripcion || ""}</p>
          <p>Stock: ${reg.stockRestante}</p>
          <button onclick="toggle('${reg.id}', this)" 
                  ${reg.stockRestante <= 0 ? "disabled style='background:#ccc;'" : ""}>
            Seleccionar
          </button>
        `;

        cont.appendChild(div);
      });
    });
}

function toggle(id, btn) {
  document.querySelectorAll('.item button').forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');
  seleccion = id;
  document.getElementById('confirm-btn').style.display = 'block';
}

document.getElementById('confirm-btn').onclick = () => {
  if (!seleccion) return;

  fetch("https://script.google.com/macros/s/AKfycbwY5TFocek-mo2wHTNGDp8LF_1uGKZvS6Ear6kPErZFz8R2Fl9MuDKx885b_RFufvWI/exec", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      nombre: "Invitado",
      apellido: "",
      email: userEmail,
      seleccion: [seleccion]   // â† IDs como tu Apps Script espera
    })
  })
  .then(r => r.json())
  .then(res => {
    if (res.success) {
      alert("Â¡Gracias por tu regalo! ðŸ’–");
      cargarCatalogo();
      document.getElementById('confirm-btn').style.display = 'none';
    } else {
      alert(res.error || "OcurriÃ³ un error");
    }
  });
};







